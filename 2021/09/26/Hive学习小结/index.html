<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hive学习小结 | Wind</title><meta name="keywords" content="大数据"><meta name="author" content="酷酷的涛"><meta name="copyright" content="酷酷的涛"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Hive学习小结Hive概述Hive：由Facebook开源用于解决海量结构化日志的数据统计。 Hive时基于Hadoop的一个数据仓库工具,可以将结构化的数据文件映射为一张表，并且提供类SQL查询功能。 本质是：将HQL转化成MapReduce程序。   Hive处理的数据存储在HDFS上 Hive分析数据底层的默认实现时MapReduce 执行程序运行在Yarn上  Hive优缺点优点：  操">
<meta property="og:type" content="article">
<meta property="og:title" content="Hive学习小结">
<meta property="og:url" content="http://example.com/2021/09/26/Hive%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93/index.html">
<meta property="og:site_name" content="Wind">
<meta property="og:description" content="Hive学习小结Hive概述Hive：由Facebook开源用于解决海量结构化日志的数据统计。 Hive时基于Hadoop的一个数据仓库工具,可以将结构化的数据文件映射为一张表，并且提供类SQL查询功能。 本质是：将HQL转化成MapReduce程序。   Hive处理的数据存储在HDFS上 Hive分析数据底层的默认实现时MapReduce 执行程序运行在Yarn上  Hive优缺点优点：  操">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/全家福.jpg">
<meta property="article:published_time" content="2021-09-26T07:45:58.000Z">
<meta property="article:modified_time" content="2021-11-19T11:22:19.155Z">
<meta property="article:author" content="酷酷的涛">
<meta property="article:tag" content="大数据">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/全家福.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/09/26/Hive%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 酷酷的涛","link":"链接: ","source":"来源: Wind","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Hive学习小结',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-11-19 19:22:19'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20210906160600.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/全家福.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Wind</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Hive学习小结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-26T07:45:58.000Z" title="发表于 2021-09-26 15:45:58">2021-09-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-19T11:22:19.155Z" title="更新于 2021-11-19 19:22:19">2021-11-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0/">大数据学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Hive学习小结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Hive学习小结"><a href="#Hive学习小结" class="headerlink" title="Hive学习小结"></a>Hive学习小结</h1><h2 id="Hive概述"><a href="#Hive概述" class="headerlink" title="Hive概述"></a>Hive概述</h2><p>Hive：由Facebook开源用于解决<font color="red">海量结构化日志</font>的数据统计。</p>
<p>Hive时基于Hadoop的一个<font color="red">数据仓库工具</font>,可以将<font color="red">结构化的数据文件映射为一张表</font>，并且提供<font color="red">类SQL</font>查询功能。</p>
<p><font color="red">本质是：将HQL转化成MapReduce程序。</font></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210926161107566.png" alt="image-20210926161107566"></p>
<ul>
<li>Hive处理的数据存储在HDFS上</li>
<li>Hive分析数据底层的默认实现时MapReduce</li>
<li>执行程序运行在Yarn上</li>
</ul>
<h2 id="Hive优缺点"><a href="#Hive优缺点" class="headerlink" title="Hive优缺点"></a>Hive优缺点</h2><p><strong>优点：</strong></p>
<ul>
<li>操作接口采用类SQL语法，提供快速开发的能力(简单、容易上手)</li>
<li>避免了去写MapReduce，减少开发人员的学习成本</li>
<li>Hive的执行延迟比较高，因此Hive常用于数据分析，对实时性要求不高的场合</li>
<li>Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执行延迟比较高</li>
<li>Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>Hive的HQL表达能力有限<ul>
<li>迭代式算法无法表达</li>
<li>数据挖掘方面不擅长</li>
</ul>
</li>
<li>Hive的效率比较低<ul>
<li>Hive自动生成的MapReduce作业，通常情况下不够智能化</li>
<li>Hive调优比较困难，粒度较粗</li>
</ul>
</li>
</ul>
<h2 id="Hive架构原理"><a href="#Hive架构原理" class="headerlink" title="Hive架构原理"></a>Hive架构原理</h2><p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210926162659494.png" alt="image-20210926162659494"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210926163152731.png" alt="image-20210926163152731"></p>
<h2 id="数据上传"><a href="#数据上传" class="headerlink" title="数据上传"></a>数据上传</h2><p>将本地数据上传可以用两种方法</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法一：</span></span><br><span class="line">hadoop dfs -put xxx---本地数据的绝对路径 /user/hive/warehouse/xx--这个xx是你自己闯的数据库</span><br><span class="line"></span><br><span class="line"><span class="comment">#方法二：</span></span><br><span class="line">直接在hive里面输入</span><br><span class="line">load data <span class="built_in">local</span> inpath <span class="string">&#x27;xxx--本地数据的绝对路径&#x27;</span> into table xxx--你自己c</span><br></pre></td></tr></table></figure>

<h2 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert overwrite local directory &#x27;xxx--本地路径&#x27; select查询语句；</span><br></pre></td></tr></table></figure>

<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="创表相关"><a href="#创表相关" class="headerlink" title="创表相关"></a>创表相关</h3><p>Hive表的默认分割符是：\001</p>
<p>以后创建表肯定要做分割的，所以需要在创表语句之后加上。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">row format delimited fields terminated by <span class="string">&#x27;xxx--你需要按照什么去分割&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看数据库更多详细信息：desc"><a href="#查看数据库更多详细信息：desc" class="headerlink" title="查看数据库更多详细信息：desc"></a>查看数据库更多详细信息：desc</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">desc database extended xxx--你需要删除的数据库名字</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210927210449453.png" alt="image-20210927210449453"></p>
<h3 id="删除数据库：drop"><a href="#删除数据库：drop" class="headerlink" title="删除数据库：drop"></a>删除数据库：drop</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">drop database xxx--你需要删除的数据库名字</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210927210838970.png" alt="image-20210927210838970"></p>
<h3 id="数据库表的操作"><a href="#数据库表的操作" class="headerlink" title="数据库表的操作"></a>数据库表的操作</h3><h4 id="内部表操作"><a href="#内部表操作" class="headerlink" title="内部表操作"></a>内部表操作</h4><h5 id="创建表的语法"><a href="#创建表的语法" class="headerlink" title="创建表的语法"></a>创建表的语法</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create [external] table [<span class="keyword">if</span> not exists] table_name(</span><br><span class="line">col_name data_type [comment <span class="string">&#x27;字段描述信息&#x27;</span>]</span><br><span class="line">col_name data_type [comment <span class="string">&#x27;字段描述信息&#x27;</span>]</span><br><span class="line">[comment <span class="string">&#x27;表的描述信息&#x27;</span>]</span><br><span class="line">[partitioned by (col_name data_type),...]</span><br><span class="line">[clustered by (col_name,col_name,...]</span><br><span class="line">[sorted by (col_name [asc|desc],...) into num_buckets buckets]</span><br><span class="line">[row format row_format]</span><br><span class="line">[storted as ...]</span><br><span class="line">[location <span class="string">&#x27;指定表的路径&#x27;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<ul>
<li>create table<ul>
<li>创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用IF NOT EXISTS 选项来忽略这个一场</li>
</ul>
</li>
<li>external<ul>
<li>可以让用户创建一个外部表，在建表的同时指定一个指向实际数据的路径(LOCATION)，<font color="red">Hive创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。</font></li>
</ul>
</li>
<li>comment<ul>
<li>表示注释，默认不能使用中文</li>
</ul>
</li>
<li>partitioned by<ul>
<li>表示使用表分区，一个表可以拥有一个或者多个分区，每一个分区单独存在一个目录下</li>
</ul>
</li>
<li>clustered by<ul>
<li>对于每一个表分文件，Hive可以进行组织成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是针对某一列进行桶的组织</li>
</ul>
</li>
<li>sorted by<ul>
<li>指定排序字段和排序规则</li>
</ul>
</li>
<li>row format<ul>
<li>指定表文件字段分隔符</li>
</ul>
</li>
<li>storted as<ul>
<li>指定表文件的存储格式。常用格式：SEQUENCEFILE,TEXTFILE,RCFILE,如果数据是纯文本，可以使用STORED AS TEXTFILE。如果数据需要压缩，使用storted as SEQUENCEFILE。</li>
</ul>
</li>
<li>location<ul>
<li>指定表文件的存储路径</li>
</ul>
</li>
</ul>
<h5 id="创建表并且指定文件的存放路径"><a href="#创建表并且指定文件的存放路径" class="headerlink" title="创建表并且指定文件的存放路径"></a>创建表并且指定文件的存放路径</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table <span class="keyword">if</span> not exists table_name(id int,name string,...) row format delimited fields terminated by <span class="string">&#x27;,&#x27;</span> location <span class="string">&#x27;xxx--你需要存放的路径&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="根据查询结果创建表"><a href="#根据查询结果创建表" class="headerlink" title="根据查询结果创建表"></a>根据查询结果创建表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table table_name as select * from table_name1; <span class="comment"># 通过复制表结构和表内容创建新表</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210927220531314.png" alt="image-20210927220531314"></p>
<h5 id="根据已经存在的表结构创建表"><a href="#根据已经存在的表结构创建表" class="headerlink" title="根据已经存在的表结构创建表"></a>根据已经存在的表结构创建表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table table_name like table_name1; <span class="comment"># 只会创建出表的结构，并不会同时创建表中的数据</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210927220740030.png" alt="image-20210927220740030"></p>
<h5 id="查看表的详细信息"><a href="#查看表的详细信息" class="headerlink" title="查看表的详细信息"></a>查看表的详细信息</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">desc formatted xxx--你表的名字</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928194521758.png" alt="image-20210928194521758"></p>
<h5 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">drop table xxx--你表的名字</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928194636315.png" alt="image-20210928194636315"></p>
<p>其实是将数据移动到了回收站。</p>
<h4 id="外部表操作"><a href="#外部表操作" class="headerlink" title="外部表操作"></a>外部表操作</h4><h5 id="外部表说明"><a href="#外部表说明" class="headerlink" title="外部表说明"></a>外部表说明</h5><p>外部表因为是指定其他的hdfs路径的数据加载到表当中来，所以hive表会认为自己不完全独占这份数据，所以删除hive表的时候，数据仍然存放在hdfs当中，不会删掉。</p>
<h5 id="内部表和外部表的使用场景"><a href="#内部表和外部表的使用场景" class="headerlink" title="内部表和外部表的使用场景"></a>内部表和外部表的使用场景</h5><p>例如：每天需要将收集到的网站日志定期流入HDFS文本文件中。然后在这个基础上对数据做大量分析，而这个数据可能要对很多部门进行共享，那么这个时候我们就需要用到外部表。而每个部门经过分析之后得到了属于自己的一些结果，那么我们就可以将生成的一些中间表，结果表使用内部表存储。数据通过SELECT+INSERT进入内部表。</p>
<p><strong>创建外部表的时候只需要加上external关键字即可。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928195839473.png" alt="image-20210928195839473"></p>
<p>此时创建的这张表就是外部表。</p>
<h5 id="查询表的类型"><a href="#查询表的类型" class="headerlink" title="查询表的类型"></a>查询表的类型</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">desc formatted xx--你的表的名字</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005104849992.png" alt="image-20211005104849992"></p>
<h5 id="修改表为外部表"><a href="#修改表为外部表" class="headerlink" title="修改表为外部表"></a>修改表为外部表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table xx--你需要修改表的名字 <span class="built_in">set</span> tblproperties(<span class="string">&#x27;EXTERNAL&#x27;</span>=<span class="string">&#x27;TRUE&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005105148917.png" alt="image-20211005105148917"></p>
<p>此时就能很直观的看到已经修改为外部表了。</p>
<p><font color="red">注意：’EXTERNAL’=’TRUE’必须是大写！！！</font></p>
<h4 id="分区表的操作"><a href="#分区表的操作" class="headerlink" title="分区表的操作"></a>分区表的操作</h4><p>在大数据中，最常用的一种思想就是分治，我们可以把大的文件切割划分成一个个的小的文件，这样每次操作一个小的文件就会很容易了，同样的道理，在hive当中也是支持这种思想的，就是我们可以把大的数据，按照每月，或者天进行切分成一个个的小的文件，存放在不同的文件夹中。</p>
<p><strong>关键字：partitioned by</strong></p>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table fst(id int,name string) partitioned by (xxx--你要以什么作为分区) row format delimited fields terminated by <span class="string">&#x27;\t&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928220614714.png" alt="image-20210928220614714"></p>
<h5 id="加载数据到分区"><a href="#加载数据到分区" class="headerlink" title="加载数据到分区"></a>加载数据到分区</h5><p>因为之前已经分过区了，所以加载数据进去的时候需要指明以什么作为分区。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928220907209.png" alt="image-20210928220907209"></p>
<h5 id="增加分区"><a href="#增加分区" class="headerlink" title="增加分区"></a>增加分区</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table xx--你的表 add partition (xxx--你的分区)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005111122502.png" alt="image-20211005111122502"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005111139585.png" alt="image-20211005111139585"></p>
<h5 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">show partitions xxx--你自己的数据表</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928221225302.png" alt="image-20210928221225302"></p>
<h5 id="删除分区"><a href="#删除分区" class="headerlink" title="删除分区"></a>删除分区</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table xxx--你自己的表 drop partition(xxx--你刚刚创的分区);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210928221456978.png" alt="image-20210928221456978"></p>
<p>可以清楚的看到我刚创的分区已经被我给删除了。</p>
<h5 id="修复表"><a href="#修复表" class="headerlink" title="修复表"></a>修复表</h5><p>当表与数据文件之间的映射关系没有建立起来时，可以对表进行修复，重新建立映射关系。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msck repair table xxx--你自己表的名称;</span><br></pre></td></tr></table></figure>

<h4 id="动态分区"><a href="#动态分区" class="headerlink" title="动态分区"></a>动态分区</h4><p>动态分区：根据数据中某几列的不同的取值划分不同的分区。但是在Hive中是默认不开启动态分区的。我们要想进行动态分区，就需要开启它。</p>
<h5 id="开启Hive的动态分区功能"><a href="#开启Hive的动态分区功能" class="headerlink" title="开启Hive的动态分区功能"></a>开启Hive的动态分区功能</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> hive.exec.dynamic.partition=<span class="literal">true</span>;	<span class="comment"># 表示开启动态分区set hive.exec.dynamic.partition.mode=nostrict;# 表示动态分区模式：strict（需要配合静态分区一起使用）、nostrictset hive.exec.max.dynamic.partitions.pernode=1000;# 表示支持的最大的分区数量为1000，可以根据业务自己调整</span></span><br></pre></td></tr></table></figure>

<h4 id="分桶表操作"><a href="#分桶表操作" class="headerlink" title="分桶表操作"></a>分桶表操作</h4><p><font color="red">分区针对的是数据的存储路径，分桶针对的是数据文件</font></p>
<p>分桶，就是将数据按照指定的字段进行划分到多个文件当中去，分桶就是MapReduce中的分区。</p>
<p>Hive默认的是关闭了分桶功能，此时我们要想进行分桶操作，就要开启它。</p>
<h5 id="开启Hive的分桶功能"><a href="#开启Hive的分桶功能" class="headerlink" title="开启Hive的分桶功能"></a>开启Hive的分桶功能</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> hive.enforce.bucketing=<span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h5 id="设置Reduce个数"><a href="#设置Reduce个数" class="headerlink" title="设置Reduce个数"></a>设置Reduce个数</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> mapreduce.job.reduce=3;</span><br></pre></td></tr></table></figure>

<h5 id="创建分桶表"><a href="#创建分桶表" class="headerlink" title="创建分桶表"></a>创建分桶表</h5><p><strong>关键字：clustered by</strong></p>
<p>例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table course(c_id string,c_name string,t_id string) clustered by (c_id) into 3 buckets row format delimited fields terminated by <span class="string">&#x27;\t&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>桶表中的数据加载，由于桶表的数据加载通过hdfs dfs -put文件或者通过load data均不好使，只能通过insert overwrite。</p>
<p>创建普通表，并通过insert overwrite的方式将普通表通过查询的方式加载到桶表当中去。</p>
<h5 id="创建普通表"><a href="#创建普通表" class="headerlink" title="创建普通表"></a>创建普通表</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">create table course_common(c_id string,c_name string,t_id string) row format delimited fields terminated by <span class="string">&#x27;\t&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="普通表中加载数据"><a href="#普通表中加载数据" class="headerlink" title="普通表中加载数据"></a>普通表中加载数据</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">load data <span class="built_in">local</span> inpath <span class="string">&#x27;xxx--你自己数据的路径&#x27;</span> into table course_common;</span><br></pre></td></tr></table></figure>

<h5 id="通过insert-overwrite给桶表中加载数据"><a href="#通过insert-overwrite给桶表中加载数据" class="headerlink" title="通过insert overwrite给桶表中加载数据"></a>通过insert overwrite给桶表中加载数据</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">insert overwrite table course select * from course_common cluster by (c_id);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210929194140298.png" alt="image-20210929194140298"></p>
<p>可以很直观的看到确实将数据分成了3份。</p>
<h3 id="修改表的结构"><a href="#修改表的结构" class="headerlink" title="修改表的结构"></a>修改表的结构</h3><h4 id="重命名"><a href="#重命名" class="headerlink" title="重命名"></a>重命名</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table old_table_name rename to new_table_name;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210929194651269.png" alt="image-20210929194651269"></p>
<p>可以很明确的看到已经修改成功了。</p>
<h4 id="添加列"><a href="#添加列" class="headerlink" title="添加列"></a>添加列</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table xxx--你需要添加的列的表 add columns (xxx--这是你需要添加的字段)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210929195327460.png" alt="image-20210929195327460"></p>
<p>可以很清楚的看到添加成功了。</p>
<h4 id="更新列"><a href="#更新列" class="headerlink" title="更新列"></a>更新列</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">alter table xxx---你需要修改的列的表 change column x--原来列的名字 xx--新的列名字 xxx--新的列属性</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20210929195801325.png" alt="image-20210929195801325"></p>
<h2 id="Hive语法"><a href="#Hive语法" class="headerlink" title="Hive语法"></a>Hive语法</h2><p>和MySQL中的基本类似。</p>
<ul>
<li>order by会对输入做全局排序，因此只有一个reducer，会导致当输入规模较大时，需要较长的计算时间。</li>
<li>sort by不是全局排序，其在数据进入reducer前完成排序。因此，如果使用sort by进行排序，并且设置mapred.reduce.task&gt;1,则sort by只保证每个reducer的输出有序，不保证全局有序。</li>
<li>distribute by(字段)根据指定的字段将数据分到不同的reducer，且分发算法是hash散列。</li>
<li>cluster by(字段)除了具有distribute by的功能外，还会对该字段进行排序。</li>
</ul>
<p>因此，如果distribute和sort字段是同一个时，此时，<font color="red">cluster by = distribute by + sort by。</font></p>
<h3 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h3><ul>
<li>count()：求总行数</li>
<li>max：求最大值</li>
<li>min：求最小值</li>
<li>sum：求和</li>
<li>avg：求平均值</li>
</ul>
<h3 id="LIMIT语句"><a href="#LIMIT语句" class="headerlink" title="LIMIT语句"></a>LIMIT语句</h3><p>典型的查询会返回多行数据。LIMIT子句用于限制返回的行数。和MySQL中的一样。</p>
<h3 id="WHERE语句"><a href="#WHERE语句" class="headerlink" title="WHERE语句"></a>WHERE语句</h3><p>和MySQL中用法一样。</p>
<h3 id="GROUP-BY语句"><a href="#GROUP-BY语句" class="headerlink" title="GROUP BY语句"></a>GROUP BY语句</h3><p>和MySQL中一样，值得注意的是：在hive中，select后面的字段必须和分组的字段一样，也可以省略不写，这点和MySQL中的有点区别。</p>
<h3 id="HIVING语句"><a href="#HIVING语句" class="headerlink" title="HIVING语句"></a>HIVING语句</h3><ul>
<li>having与where不同点<ul>
<li>where针对表中的列发挥作用，查询数据；having针对查询结果中的列发挥作用，筛选数据。</li>
<li>where后面不能写分组函数，而having后面可以使用分组函数。</li>
<li>having只用于group by分组统计语句</li>
</ul>
</li>
</ul>
<h3 id="表的别名"><a href="#表的别名" class="headerlink" title="表的别名"></a>表的别名</h3><ul>
<li>好处<ul>
<li>使用别名可以简化查询</li>
<li>使用别名前缀可以提高执行效率</li>
</ul>
</li>
</ul>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><h4 id="全局排序"><a href="#全局排序" class="headerlink" title="全局排序"></a>全局排序</h4><p>Order By：全局排序，只能有一个reduce；</p>
<ul>
<li>使用order by子句排序默认升序：ASC;降序：DESC</li>
<li>order by子句在select语句的结尾。</li>
</ul>
<h4 id="每个MapReduce内部排序-sort-by-局部排序"><a href="#每个MapReduce内部排序-sort-by-局部排序" class="headerlink" title="每个MapReduce内部排序(sort by)局部排序"></a>每个MapReduce内部排序(sort by)局部排序</h4><p>sort by：每个MapReduce内部进行排序，对全局结果集来说不是排序。</p>
<p>设置reduce个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> mapreduce.job.reduce=3;</span><br></pre></td></tr></table></figure>

<p>查看设置reduce个数</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> mapreduce.job.reduces;</span><br></pre></td></tr></table></figure>

<p>将查询结果文件导入到本地</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">insert overwrite local directory &#x27;xxx--本地路径&#x27; select查询语句；</span><br></pre></td></tr></table></figure>

<h4 id="分区排序-DISTRIBUTE-BY"><a href="#分区排序-DISTRIBUTE-BY" class="headerlink" title="分区排序(DISTRIBUTE BY)"></a>分区排序(DISTRIBUTE BY)</h4><p>Distribute By：类似MR中的partition，进行分区，结合sort by使用。</p>
<p>注意：Hive要求distribute by语句要写在sort by语句之前</p>
<p>对于distribute by进行测试，一定要分配多个reduce进行处理，否则无法看到distribute by的效果。</p>
<p>设置reduce的个数，将我们对应的文件划分到对应的reduce中去。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">set</span> mapreduce.job.reduces=xx--你想设置的个数；</span><br></pre></td></tr></table></figure>

<h4 id="Cluster-By"><a href="#Cluster-By" class="headerlink" title="Cluster By"></a>Cluster By</h4><p>当distribute by和sort by字段相同时，可以使用cluster by方式。</p>
<p>cluster by除了具有distribute by的功能外还兼具sort by的功能。但是排序<font color="red">只能是升序排序，</font>不能指定排序规则为ASC或者DESC。</p>
<h2 id="Hive函数"><a href="#Hive函数" class="headerlink" title="Hive函数"></a>Hive函数</h2><h3 id="空字段赋值"><a href="#空字段赋值" class="headerlink" title="空字段赋值"></a>空字段赋值</h3><p>NVL：给值为NULL的数据赋值，它的格式是NVL(string1，replace_with)。它的功能是如果string1为NULL，则NVL函数返回replace_with，否则返回string1的值，如果两个参数都为NULL，则返回NULL。</p>
<h3 id="时间类"><a href="#时间类" class="headerlink" title="时间类"></a>时间类</h3><ul>
<li>date_format:格式化时间</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005143243726.png" alt="image-20211005143243726"></p>
<ul>
<li>date_add:时间跟天数相加</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005143310544.png" alt="image-20211005143310544"></p>
<ul>
<li>date_sub:时间跟天数相减</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005143349752.png" alt="image-20211005143349752"></p>
<ul>
<li>datediff:两个时间相减</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005143430189.png" alt="image-20211005143430189"></p>
<h3 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h3><p>CONCAT(string A/col, string B/col…)：返回输入字符串连接后的结果，支持任意个输入字符串;</p>
<p>CONCAT_WS(separator, str1, str2,…)：它是一个特殊形式的 CONCAT()。第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;</p>
<p>COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生 array 类型字段。</p>
<h4 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h4><p>拼接任意字符串</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005154504775.png" alt="image-20211005154504775"></p>
<h4 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws"></a>concat_ws</h4><p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005155520173.png" alt="image-20211005155520173"></p>
<h3 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h3><p>EXPLODE(col)：将 hive 一列中复杂的 array 或者 map 结构拆分成多行。</p>
<p>LATERAL VIEW</p>
<p>用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</p>
<p>解释：用于和 split, explode 等 UDTF 一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</p>
<p>例如：</p>
<p>这里的数据是我自己准备好的。需要将电影分类中的数组数据展开成如下结果</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005182142031.png" alt="image-20211005182142031"></p>
<p><strong>原数据：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005182206876.png" alt="image-20211005182206876"></p>
<p>导入数据如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005182650003.png" alt="image-20211005182650003"></p>
<p>结果如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select movie,category_name from movie_info lateral view explode(category) table_tmp as category_name;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211005183846684.png" alt="image-20211005183846684"></p>
<h3 id="窗口函数"><a href="#窗口函数" class="headerlink" title="窗口函数"></a>窗口函数</h3><p>OVER()：指定分析函数工作的数据窗口大小，这个数据窗口大小可能会随着行的变化</p>
<p>而变化；</p>
<p>CURRENT ROW：当前行； </p>
<p>n PRECEDING：往前 n 行数据； </p>
<p>n FOLLOWING：往后 n 行数据；</p>
<p>UNBOUNDED：起点，UNBOUNDED PRECEDING 表示从前面的起点，UNBOUNDED FOLLOWING 表示到后面的终点； </p>
<p>LAG(col,n)：往前第 n 行数据；</p>
<p>LEAD(col,n)：往后第 n 行数据；</p>
<p>NTILE(n)：把有序分区中的行分发到指定数据的组中，各个组有编号，编号从 1 开始，</p>
<p>对于每一行，NTILE 返回此行所属的组的编号。注意：n 必须为 int 类型</p>
<h3 id="RANK"><a href="#RANK" class="headerlink" title="RANK"></a>RANK</h3><p>RANK() 排序相同时会重复，总数不会变</p>
<p>DENSE_RANK() 排序相同时会重复，总数会减少</p>
<p>ROW_NUMBER() 会根据顺序计算</p>
<p>举例说明，以下数据是为了计算排名：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">		RANK()		DENSE_RANK()		ROW_NUMBER()</span><br><span class="line">90		 1				1					1</span><br><span class="line">90    	 1				1					2</span><br><span class="line">80		 3				2					3</span><br><span class="line">70		 4				3					4</span><br></pre></td></tr></table></figure>

<h3 id="窗口帧格式-即滑动窗口"><a href="#窗口帧格式-即滑动窗口" class="headerlink" title="窗口帧格式(即滑动窗口)"></a>窗口帧格式(即滑动窗口)</h3><p>窗口帧格式<br>    格式1:按照行的记录取值<br>        ROWS  BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)<br>    格式2:当前所指定值的范围取值<br>        RANGE BETWEEN (UNBOUNDED | [num]) PRECEDING AND ([num] PRECEDING | CURRENT ROW | (UNBOUNDED | [num]) FOLLOWING)<br>    注意:<br>        UNBOUNDED:无界限<br>        CURRENT ROW:当前行</p>
<p>rows格式1:前2行+当前行+后两行<br>    sum(score) over (partition by clazz order by score desc rows between 2 PRECEDING and 2 FOLLOWING)<br>rows格式2:前记录到最末尾的总和<br>    sum(score) over (partition by clazz order by score desc rows between CURRENT ROW and UNBOUNDED FOLLOWING)</p>
<p>range格式1: 如果当前值在80,取值就会落在范围在80-2=78和80+2=82组件之内的行<br>    max(score) over (partition by clazz order by score desc range between 2 PRECEDING and 2 FOLLOWING)</p>
<h2 id="自定义函数UDF"><a href="#自定义函数UDF" class="headerlink" title="自定义函数UDF"></a>自定义函数UDF</h2><p>Hive 提供的内置函数无法满足你的业务处理需要时,此时就可以考虑使用用户自定义函数。</p>
<h3 id="UDF一进一出"><a href="#UDF一进一出" class="headerlink" title="UDF一进一出"></a>UDF一进一出</h3><h4 id="一个参数"><a href="#一个参数" class="headerlink" title="一个参数"></a>一个参数</h4><p>1.首先创建maven项目并添加依赖</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.hive&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;hive-exec&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.编写代码，继承org.apache.hadoop.hive.ql.exec.UDF <strong>实现evaluate方法</strong>，在evaluate方法中实现自己的逻辑</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"></span><br><span class="line">public class HiveUDF extends UDF &#123;</span><br><span class="line">    public String evaluate(String str)&#123;</span><br><span class="line">        String s = <span class="string">&quot;---&quot;</span>+str+<span class="string">&quot;---&quot;</span>;</span><br><span class="line">        <span class="built_in">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.打成jar包上传至虚拟机</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211008211855026.png" alt="image-20211008211855026"></p>
<p>上传至存放包的路径下</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/image-20211008211934906.png" alt="image-20211008211934906"></p>
<p>4.进入hive客户端添加jar包</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/c02a3abffa7e4d768f952d272011eff1.png" alt="在这里插入图片描述"></p>
<p>5.创建临时函数：hive&gt;CREATE TEMPORARY FUNCTION f_up as ‘name’;</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/21b4a5344b6f4f918f6447c761b653d5.png" alt="img"></p>
<p>6.使用HiveUDF函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/345a07fd7f734a4697c3bfe1d7ae223b.png" alt="img"></p>
<h4 id="多个参数"><a href="#多个参数" class="headerlink" title="多个参数"></a>多个参数</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import org.apache.hadoop.hive.ql.exec.UDF;</span><br><span class="line"></span><br><span class="line">public class HiveUDF01 extends UDF &#123;</span><br><span class="line">    public String evaluate(String str1,String str2)&#123;</span><br><span class="line">        String s = str1+<span class="string">&quot;---&quot;</span>+str2;</span><br><span class="line">        <span class="built_in">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现有多个参数的时候，也是可以只输出一个结果，所以UDAF（多进一出就不常用）</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/611d43e45ca5421cabb045bea9163c5d.png" alt="img"></p>
<h3 id="UDTF一进多出"><a href="#UDTF一进多出" class="headerlink" title="UDTF一进多出"></a>UDTF一进多出</h3><p>大致的步骤差不多，这里只给出关键代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.exec.UDFArgumentException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.metadata.HiveException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.ql.udf.generic.GenericUDTF;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.serde2.objectinspector.ObjectInspector;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.serde2.objectinspector.ObjectInspectorFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.serde2.objectinspector.PrimitiveObjectInspector;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.serde2.objectinspector.StructObjectInspector;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hive.serde2.objectinspector.primitive.PrimitiveObjectInspectorFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiveUDTF</span> <span class="keyword">extends</span> <span class="title">GenericUDTF</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1.3.1之后不需要写</span></span><br><span class="line">    <span class="comment">//初始化：指定输出的数量和输出的格式</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StructObjectInspector <span class="title">initialize</span><span class="params">(StructObjectInspector argOIs)</span> <span class="keyword">throws</span> UDFArgumentException </span>&#123;</span><br><span class="line">        <span class="comment">//指定输出多少列（操作列的数量和名称）</span></span><br><span class="line">        ArrayList&lt;String&gt; fieldName = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="comment">//操作列的类型</span></span><br><span class="line">        ArrayList&lt;ObjectInspector&gt; fieldObj = <span class="keyword">new</span> ArrayList&lt;ObjectInspector&gt;();<span class="comment">//检测当前给的是什么类型</span></span><br><span class="line">        <span class="comment">//输出两列</span></span><br><span class="line">        <span class="comment">//第一列</span></span><br><span class="line">        fieldName.add(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">        fieldObj.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);<span class="comment">//检查给的是不是String类型</span></span><br><span class="line">        <span class="comment">//第二列</span></span><br><span class="line">        fieldName.add(<span class="string">&quot;y&quot;</span>);</span><br><span class="line">        fieldObj.add(PrimitiveObjectInspectorFactory.javaStringObjectInspector);</span><br><span class="line">        <span class="keyword">return</span> ObjectInspectorFactory.getStandardStructObjectInspector(fieldName,fieldObj);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//假设进来的格式为：(&quot;k1:v1,k2:v2,k3:v3&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Object[] objects)</span> <span class="keyword">throws</span> HiveException </span>&#123;</span><br><span class="line">        String s = objects[<span class="number">0</span>].toString();<span class="comment">//这里的参数0，指的就是上面进来的格式</span></span><br><span class="line">        <span class="comment">//切分出来每行数据</span></span><br><span class="line">        String[] rows = s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String row : rows) &#123;</span><br><span class="line">            String[] split = row.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="comment">//通过forward()输出</span></span><br><span class="line">            forward(split);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打包上传并且注册函数并执行</p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/f2a0c5d6b2564b0bb54e3d06c212b6b6.png" alt="img"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/3fa04a84a9e84e989187a19668f94f8c.png" alt="img"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/全家福.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/08/HiveSQL%E7%BB%83%E4%B9%A0%E9%A2%98/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/列车.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HiveSQL练习题</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/25/Hive%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/樱花.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hive环境搭建</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/23/Flink/" title="Flink"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/小孩.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-23</div><div class="title">Flink</div></div></a></div><div><a href="/2021/10/22/Flume学习小结/" title="Flume学习小结"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/橘子.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-22</div><div class="title">Flume学习小结</div></div></a></div><div><a href="/2021/10/09/HBase安装教程/" title="HBase安装教程"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/童年.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-09</div><div class="title">HBase安装教程</div></div></a></div><div><a href="/2021/10/18/HBase的RowKeyy设计/" title="HBase的RowKey设计"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/窗户.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-18</div><div class="title">HBase的RowKey设计</div></div></a></div><div><a href="/2021/09/20/Hadoop学习/" title="Hadoop学习"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/初音未来.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-20</div><div class="title">Hadoop学习</div></div></a></div><div><a href="/2021/10/08/HiveSQL练习题/" title="HiveSQL练习题"><img class="cover" src="https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/列车.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-08</div><div class="title">HiveSQL练习题</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hive%E5%AD%A6%E4%B9%A0%E5%B0%8F%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text">Hive学习小结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Hive概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">Hive优缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">Hive架构原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.4.</span> <span class="toc-text">数据上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA"><span class="toc-number">1.5.</span> <span class="toc-text">数据导出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.</span> <span class="toc-text">数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E8%A1%A8%E7%9B%B8%E5%85%B3"><span class="toc-number">1.6.1.</span> <span class="toc-text">创表相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9B%B4%E5%A4%9A%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF%EF%BC%9Adesc"><span class="toc-number">1.6.2.</span> <span class="toc-text">查看数据库更多详细信息：desc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%9Adrop"><span class="toc-number">1.6.3.</span> <span class="toc-text">删除数据库：drop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.</span> <span class="toc-text">数据库表的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">内部表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.4.1.1.</span> <span class="toc-text">创建表的语法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8%E5%B9%B6%E4%B8%94%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%98%E6%94%BE%E8%B7%AF%E5%BE%84"><span class="toc-number">1.6.4.1.2.</span> <span class="toc-text">创建表并且指定文件的存放路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">1.6.4.1.3.</span> <span class="toc-text">根据查询结果创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%E7%9A%84%E8%A1%A8%E7%BB%93%E6%9E%84%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">1.6.4.1.4.</span> <span class="toc-text">根据已经存在的表结构创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.4.1.5.</span> <span class="toc-text">查看表的详细信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">1.6.4.1.6.</span> <span class="toc-text">删除表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">外部表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E8%A1%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.4.2.1.</span> <span class="toc-text">外部表说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8%E5%92%8C%E5%A4%96%E9%83%A8%E8%A1%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.4.2.2.</span> <span class="toc-text">内部表和外部表的使用场景</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.4.2.3.</span> <span class="toc-text">查询表的类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E4%B8%BA%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="toc-number">1.6.4.2.4.</span> <span class="toc-text">修改表为外部表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.3.</span> <span class="toc-text">分区表的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0%E5%88%86%E5%8C%BA"><span class="toc-number">1.6.4.3.1.</span> <span class="toc-text">加载数据到分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%88%86%E5%8C%BA"><span class="toc-number">1.6.4.3.2.</span> <span class="toc-text">增加分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%88%86%E5%8C%BA"><span class="toc-number">1.6.4.3.3.</span> <span class="toc-text">查看分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%86%E5%8C%BA"><span class="toc-number">1.6.4.3.4.</span> <span class="toc-text">删除分区</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8D%E8%A1%A8"><span class="toc-number">1.6.4.3.5.</span> <span class="toc-text">修复表</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA"><span class="toc-number">1.6.4.4.</span> <span class="toc-text">动态分区</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AFHive%E7%9A%84%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.4.4.1.</span> <span class="toc-text">开启Hive的动态分区功能</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.5.</span> <span class="toc-text">分桶表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AFHive%E7%9A%84%E5%88%86%E6%A1%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">1.6.4.5.1.</span> <span class="toc-text">开启Hive的分桶功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEReduce%E4%B8%AA%E6%95%B0"><span class="toc-number">1.6.4.5.2.</span> <span class="toc-text">设置Reduce个数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E6%A1%B6%E8%A1%A8"><span class="toc-number">1.6.4.5.3.</span> <span class="toc-text">创建分桶表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%99%AE%E9%80%9A%E8%A1%A8"><span class="toc-number">1.6.4.5.4.</span> <span class="toc-text">创建普通表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.4.5.5.</span> <span class="toc-text">普通表中加载数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E8%BF%87insert-overwrite%E7%BB%99%E6%A1%B6%E8%A1%A8%E4%B8%AD%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">1.6.4.5.6.</span> <span class="toc-text">通过insert overwrite给桶表中加载数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.6.5.</span> <span class="toc-text">修改表的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">重命名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%88%97"><span class="toc-number">1.6.5.2.</span> <span class="toc-text">添加列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%88%97"><span class="toc-number">1.6.5.3.</span> <span class="toc-text">更新列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E8%AF%AD%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">Hive语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.7.1.</span> <span class="toc-text">常用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LIMIT%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.7.2.</span> <span class="toc-text">LIMIT语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WHERE%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.7.3.</span> <span class="toc-text">WHERE语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GROUP-BY%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.7.4.</span> <span class="toc-text">GROUP BY语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HIVING%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.7.5.</span> <span class="toc-text">HIVING语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-number">1.7.6.</span> <span class="toc-text">表的别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">1.7.7.</span> <span class="toc-text">排序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F"><span class="toc-number">1.7.7.1.</span> <span class="toc-text">全局排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%8F%E4%B8%AAMapReduce%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F-sort-by-%E5%B1%80%E9%83%A8%E6%8E%92%E5%BA%8F"><span class="toc-number">1.7.7.2.</span> <span class="toc-text">每个MapReduce内部排序(sort by)局部排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E6%8E%92%E5%BA%8F-DISTRIBUTE-BY"><span class="toc-number">1.7.7.3.</span> <span class="toc-text">分区排序(DISTRIBUTE BY)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cluster-By"><span class="toc-number">1.7.7.4.</span> <span class="toc-text">Cluster By</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hive%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.</span> <span class="toc-text">Hive函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%BA%E5%AD%97%E6%AE%B5%E8%B5%8B%E5%80%BC"><span class="toc-number">1.8.1.</span> <span class="toc-text">空字段赋值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E7%B1%BB"><span class="toc-number">1.8.2.</span> <span class="toc-text">时间类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="toc-number">1.8.3.</span> <span class="toc-text">行转列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#concat"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">concat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#concat-ws"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">concat_ws</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="toc-number">1.8.4.</span> <span class="toc-text">列转行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.5.</span> <span class="toc-text">窗口函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RANK"><span class="toc-number">1.8.6.</span> <span class="toc-text">RANK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AA%97%E5%8F%A3%E5%B8%A7%E6%A0%BC%E5%BC%8F-%E5%8D%B3%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-number">1.8.7.</span> <span class="toc-text">窗口帧格式(即滑动窗口)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0UDF"><span class="toc-number">1.9.</span> <span class="toc-text">自定义函数UDF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDF%E4%B8%80%E8%BF%9B%E4%B8%80%E5%87%BA"><span class="toc-number">1.9.1.</span> <span class="toc-text">UDF一进一出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">一个参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">多个参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDTF%E4%B8%80%E8%BF%9B%E5%A4%9A%E5%87%BA"><span class="toc-number">1.9.2.</span> <span class="toc-text">UDTF一进多出</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/Fang-gg/picture/img/全家福.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By 酷酷的涛</div><div class="footer_custom_text">很高兴认识你！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="2919023249" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>